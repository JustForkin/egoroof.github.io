!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.ID3Writer=t():e.ID3Writer=t()}(this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var a=r[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var r={};return t.m=e,t.c=r,t.i=function(e){return e},t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=4)}([function(e,t,r){"use strict";function n(e){var t=String(e).split("").map(function(e){return e.charCodeAt(0)});return new Uint8Array(t)}function a(e){var t=String(e).split("").map(function(e){return e.charCodeAt(0)}),r=new Uint8Array(2*e.length);return new Uint16Array(r.buffer).set(t),r}t.a=n,t.b=a},function(e,t,r){"use strict";function n(e){return 73===e[0]&&68===e[1]&&51===e[2]}function a(e){if(!e||!e.length)return null;if(255===e[0]&&216===e[1]&&255===e[2])return"image/jpeg";if(137===e[0]&&80===e[1]&&78===e[2]&&71===e[3])return"image/png";if(71===e[0]&&73===e[1]&&70===e[2])return"image/gif";if(87===e[8]&&69===e[9]&&66===e[10]&&80===e[11])return"image/webp";var t=73===e[0]&&73===e[1]&&42===e[2]&&0===e[3],r=77===e[0]&&77===e[1]&&0===e[2]&&42===e[3];return t||r?"image/tiff":66===e[0]&&77===e[1]?"image/bmp":0===e[0]&&0===e[1]&&1===e[2]&&0===e[3]?"image/x-icon":null}t.b=n,t.a=a},function(e,t,r){"use strict";function n(e){var t=10,r=1;return t+r+e}function a(e){var t=10,r=1,n=2,a=2*e;return t+r+n+a}function i(e,t){var r=10,n=1,a=3,i=2,s=2*e,o=2,u=2*t;return r+n+a+i+s+o+i+u}function s(e,t,r){var n=10,a=1,i=1,s=1,o=2,u=2*r;return n+a+t+i+s+o+u+i+i+e}function o(e,t){var r=10,n=1,a=3,i=2,s=2*e,o=2,u=2*t;return r+n+a+i+s+o+i+u}function u(e,t){var r=10,n=1,a=2,i=2*e,s=2,o=2*t;return r+n+a+i+s+a+o}function c(e){var t=10;return t+e}t.a=n,t.b=a,t.d=i,t.c=s,t.e=o,t.f=u,t.g=c},function(e,t,r){"use strict";function n(e){var t=255;return[e>>>24&t,e>>>16&t,e>>>8&t,e&t]}function a(e){var t=127;return[e>>>21&t,e>>>14&t,e>>>7&t,e&t]}function i(e){return(e[0]<<21)+(e[1]<<14)+(e[2]<<7)+e[3]}t.c=n,t.b=a,t.a=i},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=r(0),i=r(1),s=r(3),o=r(2),u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),f=function(){function e(t){if(n(this,e),!(t&&"object"===("undefined"==typeof t?"undefined":u(t))&&"byteLength"in t))throw new Error("First argument should be an instance of ArrayBuffer or Buffer");this.arrayBuffer=t,this.padding=4096,this.frames=[],this.url=""}return c(e,[{key:"_setIntegerFrame",value:function(e,t){var r=parseInt(t,10);this.frames.push({name:e,value:r,size:o.a(r.toString().length)})}},{key:"_setStringFrame",value:function(e,t){var r=t.toString();this.frames.push({name:e,value:r,size:o.b(r.length)})}},{key:"_setPictureFrame",value:function(e,t,r){var n=i.a(new Uint8Array(t)),a=r.toString();if(!n)throw new Error("Unknown picture MIME type");this.frames.push({name:"APIC",value:t,pictureType:e,mimeType:n,description:a,size:o.c(t.byteLength,n.length,a.length)})}},{key:"_setLyricsFrame",value:function(e,t){var r=e.toString(),n=t.toString();this.frames.push({name:"USLT",value:n,description:r,size:o.d(r.length,n.length)})}},{key:"_setCommentFrame",value:function(e,t){var r=e.toString(),n=t.toString();this.frames.push({name:"COMM",value:n,description:r,size:o.e(r.length,n.length)})}},{key:"_setUserStringFrame",value:function(e,t){var r=e.toString(),n=t.toString();this.frames.push({name:"TXXX",description:r,value:n,size:o.f(r.length,n.length)})}},{key:"_setUrlLinkFrame",value:function(e,t){var r=t.toString();this.frames.push({name:e,value:r,size:o.g(r.length)})}}]),c(e,[{key:"setFrame",value:function(e,t){switch(e){case"TPE1":case"TCOM":case"TCON":if(!Array.isArray(t))throw new Error(e+" frame value should be an array of strings");var r="TCON"===e?";":"/",n=t.join(r);this._setStringFrame(e,n);break;case"TIT2":case"TALB":case"TPE2":case"TPE3":case"TPE4":case"TRCK":case"TPOS":case"TMED":case"TPUB":this._setStringFrame(e,t);break;case"TBPM":case"TLEN":case"TYER":this._setIntegerFrame(e,t);break;case"USLT":if(!("object"===("undefined"==typeof t?"undefined":u(t))&&"description"in t&&"lyrics"in t))throw new Error("USLT frame value should be an object with keys description and lyrics");this._setLyricsFrame(t.description,t.lyrics);break;case"APIC":if(!("object"===("undefined"==typeof t?"undefined":u(t))&&"type"in t&&"data"in t&&"description"in t))throw new Error("APIC frame value should be an object with keys type, data and description");if(t.type<0||t.type>20)throw new Error("Incorrect APIC frame picture type");this._setPictureFrame(t.type,t.data,t.description);break;case"TXXX":if(!("object"===("undefined"==typeof t?"undefined":u(t))&&"description"in t&&"value"in t))throw new Error("TXXX frame value should be an object with keys description and value");this._setUserStringFrame(t.description,t.value);break;case"TKEY":if(!/^([A-G][#b]?m?|o)$/.test(t))throw new Error(e+" frame value should be like Dbm, C#, B or o");this._setStringFrame(e,t);break;case"WCOM":case"WCOP":case"WOAF":case"WOAR":case"WOAS":case"WORS":case"WPAY":case"WPUB":this._setUrlLinkFrame(e,t);break;case"COMM":if(!("object"===("undefined"==typeof t?"undefined":u(t))&&"description"in t&&"text"in t))throw new Error("COMM frame value should be an object with keys description and text");this._setCommentFrame(t.description,t.text);break;default:throw new Error("Unsupported frame "+e)}return this}},{key:"removeTag",value:function(){var e=10;if(!(this.arrayBuffer.byteLength<e)){var t=new Uint8Array(this.arrayBuffer),r=t[3],n=s.a([t[6],t[7],t[8],t[9]])+e;!i.b(t)||r<2||r>4||(this.arrayBuffer=new Uint8Array(t.subarray(n)).buffer)}}},{key:"addTag",value:function(){this.removeTag();var e=[255,254],t=[101,110,103],r=10,n=this.frames.reduce(function(e,t){return e+t.size},0),i=r+n+this.padding,o=new ArrayBuffer(this.arrayBuffer.byteLength+i),u=new Uint8Array(o),c=0,f=[];return f=[73,68,51,3],u.set(f,c),c+=f.length,c++,c++,f=s.b(i-r),u.set(f,c),c+=f.length,this.frames.forEach(function(n){switch(f=a.a(n.name),u.set(f,c),c+=f.length,f=s.c(n.size-r),u.set(f,c),c+=f.length,c+=2,n.name){case"WCOM":case"WCOP":case"WOAF":case"WOAR":case"WOAS":case"WORS":case"WPAY":case"WPUB":f=a.a(n.value),u.set(f,c),c+=f.length;break;case"TPE1":case"TCOM":case"TCON":case"TIT2":case"TALB":case"TPE2":case"TPE3":case"TPE4":case"TRCK":case"TPOS":case"TKEY":case"TMED":case"TPUB":f=[1].concat(e),u.set(f,c),c+=f.length,f=a.b(n.value),u.set(f,c),c+=f.length;break;case"TXXX":case"USLT":case"COMM":f=[1],"USLT"!==n.name&&"COMM"!==n.name||(f=f.concat(t)),f=f.concat(e),u.set(f,c),c+=f.length,f=a.b(n.description),u.set(f,c),c+=f.length,f=[0,0].concat(e),u.set(f,c),c+=f.length,f=a.b(n.value),u.set(f,c),c+=f.length;break;case"TBPM":case"TLEN":case"TYER":c++,f=a.a(n.value),u.set(f,c),c+=f.length;break;case"APIC":f=[1],u.set(f,c),c+=f.length,f=a.a(n.mimeType),u.set(f,c),c+=f.length,f=[0,n.pictureType].concat(e),u.set(f,c),c+=f.length,f=a.b(n.description),u.set(f,c),c+=f.length,c+=2,u.set(new Uint8Array(n.value),c),c+=n.value.byteLength}}),c+=this.padding,u.set(new Uint8Array(this.arrayBuffer),c),this.arrayBuffer=o,o}},{key:"getBlob",value:function(){return new Blob([this.arrayBuffer],{type:"audio/mpeg"})}},{key:"getURL",value:function(){return this.url||(this.url=URL.createObjectURL(this.getBlob())),this.url}},{key:"revokeURL",value:function(){URL.revokeObjectURL(this.url)}}]),e}();e.exports=f}])});